name: Auto Monitoring

on:
  schedule:
    - cron: '0 * * * *' # har 1 ghante
  workflow_dispatch:

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y jq
          go install github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: Run httpx
        run: |
          echo "zerobounce.net" > targets.txt
          "$HOME/go/bin/httpx" -l targets.txt -silent -o alive.txt

      - name: Run nuclei
        run: |
          "$HOME/go/bin/nuclei" -l alive.txt -severity medium,high,critical -o result.txt || true

      - name: Send Telegram Alert (only if findings)
        if: success()
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          if [ -s result.txt ]; then
            MESSAGE="ðŸš¨ Nuclei Alert!\n\n$(head -n 20 result.txt)"

            curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
              -d chat_id="${TELEGRAM_CHAT_ID}" \
              --data-urlencode text="$MESSAGE"
          else
            echo "No findings, not sending Telegram message."
          fi
